<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒŸãƒ‹å›³é‘‘</title>
  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827cc;      /* gray-900 + alpha */
      --card:#111827;         /* gray-900 */
      --text:#e5e7eb;         /* gray-200 */
      --muted:#94a3b8;        /* slate-400 */
      --accent:#38bdf8;       /* sky-400 */
      --accent-2:#34d399;     /* emerald-400 */
      --ring:#22d3ee55;       /* cyan ring */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 600px at 20% -10%, #1f2937 0%, #0b1222 40%, var(--bg) 70%);
      color:var(--text); font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic UI", Arial, sans-serif;
    }
    .wrap{max-width:1080px; margin:0 auto; padding:24px 16px 80px}
    header{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px}
    .title{font-weight:800; letter-spacing:.02em;}
    .title .jp{font-size:28px}
    .title .en{font-size:12px; color:var(--muted); letter-spacing:.2em}

    .toolbar{display:grid; grid-template-columns: 1fr auto auto; gap:12px; background:var(--panel); padding:12px; border-radius:14px; box-shadow: 0 10px 30px #0008}
    .search{position:relative}
    .search input{
      width:100%; padding:12px 14px 12px 40px; border-radius:10px; border:1px solid #334155; background:#0b1222; color:var(--text);
      outline:none; box-shadow:none; transition:.2s border-color,.2s box-shadow
    }
    .search input:focus{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}
    .search svg{position:absolute; left:10px; top:50%; transform:translateY(-50%); opacity:.6}

    select, button{
      padding:12px 14px; border-radius:10px; border:1px solid #334155; background:#0b1222; color:var(--text); cursor:pointer
    }
    button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-2)); border:none; font-weight:700}

    .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(220px, 1fr)); gap:14px; margin-top:16px}

    .card{
      background:linear-gradient(180deg, #0f172a, #0b1222 60%);
      border:1px solid #233146; border-radius:16px; overflow:hidden; position:relative; transition: transform .15s ease, box-shadow .15s ease, border-color .2s;
      box-shadow:0 6px 18px #0009
    }
    .card:hover{transform:translateY(-2px); box-shadow:0 14px 28px #000a; border-color:#2e3d56}

    .thumb{aspect-ratio: 16/10; display:grid; place-items:center; background:#0b1222; font-size:12px; color:var(--muted)}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}

    .body{padding:12px 12px 14px}
    .name{font-weight:800; margin:2px 0 6px}
    .meta{font-size:12px; color:var(--muted); display:flex; gap:6px; flex-wrap:wrap}
    .tag{border:1px solid #334155; padding:2px 8px; border-radius:999px}

    .desc{font-size:13px; color:#cbd5e1; margin-top:8px; line-height:1.55; height:3.3em; overflow:hidden}

    .count{margin:14px 2px 0; font-size:13px; color:var(--muted)}

    dialog{border:none; border-radius:20px; padding:0; width:min(720px, 92vw); background:#0b1222; color:var(--text)}
    .modal-head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #22314a; background:#0f172a}
    .modal-body{padding:16px}
    .modal-body img{width:100%; border-radius:14px; border:1px solid #22314a}
    .modal-grid{display:grid; grid-template-columns:2fr 3fr; gap:16px; margin-top:12px}
    .kv{display:grid; gap:8px; font-size:14px}
    .kv div{display:grid; grid-template-columns:92px 1fr; gap:8px}

    .footer{position:fixed; inset:auto 0 0; background:linear-gradient(180deg,#0000,#0006 30%, #000d 60%); padding:12px 16px}
    .footer .inner{max-width:1080px; margin:0 auto; display:flex; gap:8px; align-items:center; justify-content:space-between}
    .hint{font-size:12px; color:var(--muted)}

    @media (max-width:720px){
      .toolbar{grid-template-columns: 1fr 1fr; grid-auto-rows: auto}
      .toolbar .search{grid-column:1/3}
      .modal-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="jp">ãƒŸãƒ‹å›³é‘‘</div>
        <div class="en">Simple Encyclopedia</div>
      </div>
      <button id="exportBtn" class="primary" title="ãƒ‡ãƒ¼ã‚¿(JSON)ã‚’æ›¸ãå‡ºã—">ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãå‡ºã—</button>
    </header>

    <section class="toolbar" role="region" aria-label="æ¤œç´¢ã¨çµã‚Šè¾¼ã¿">
      <div class="search">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="10.5" cy="10.5" r="6.5" stroke="currentColor" stroke-width="2"/></svg>
        <input id="q" type="search" placeholder="åå‰ãƒ»ã‚¿ã‚°ãƒ»èª¬æ˜ã§æ¤œç´¢" autocomplete="off" />
      </div>
      <select id="category">
        <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
      </select>
      <select id="sort">
        <option value="name">åå‰é †</option>
        <option value="new">æ–°ã—ã„é †</option>
      </select>
    </section>

    <div class="count" id="count"></div>
    <section class="grid" id="grid" aria-live="polite"></section>
  </div>

  <dialog id="modal">
    <div class="modal-head">
      <strong id="mName">åç§°</strong>
      <button id="closeModal">é–‰ã˜ã‚‹</button>
    </div>
    <div class="modal-body">
      <img id="mImg" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" />
      <div class="modal-grid">
        <div class="kv" id="mKv"></div>
        <div>
          <h3 style="margin:0 0 8px">èª¬æ˜</h3>
          <p id="mDesc" style="line-height:1.7"></p>
          <div id="mTags" style="display:flex; gap:6px; flex-wrap:wrap; margin-top:12px"></div>
        </div>
      </div>
    </div>
  </dialog>

  <div class="footer">
    <div class="inner">
      <div class="hint">ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ã¯ <code>data</code> é…åˆ—ã‚’ç·¨é›†ã—ã¦å¢—ã‚„ã›ã¾ã™ã€‚ç”»åƒã¯ <code>images/ãƒ•ã‚¡ã‚¤ãƒ«å</code> ã‚’ç½®ãã‹ã€URLã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚</div>
      <button id="addSample" title="ã‚µãƒ³ãƒ—ãƒ«ã‚’1ä»¶è¿½åŠ ">ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ </button>
    </div>
  </div>

  <script>
    /**
     * \u25C6 ä½¿ã„æ–¹
     * 1) ä¸‹ã® data é…åˆ—ã‚’ç·¨é›†ã—ã¦é …ç›®ã‚’å¢—ã‚„ã™
     * 2) images ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã€ imageUrl ã«æ›¸ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã (ã¾ãŸã¯ https://... ã®URLã‚’å…¥ã‚Œã‚‹)
     * 3) GitHub Pages ã«ãƒ‡ãƒ—ãƒ­ã‚¤ (index.html ã ã‘ã§ã‚‚å‹•ãã¾ã™)
     */

    /** @typedef {{ id:string, name:string, category:string, description:string, tags:string[], imageUrl?:string, createdAt?:string, size?:string, habitat?:string, note?:string }} Entry */

    /** @type {Entry[]} */
    const data = [
      {
        id: "1",
        name: "ã‚¢ã‚ªã‚¬ã‚¨ãƒ«",
        category: "ä¸¡ç”Ÿé¡",
        description: "æ¨¹ä¸Šã§ç”Ÿæ´»ã™ã‚‹å°å‹ã®ã‚«ã‚¨ãƒ«ã€‚å¸ç›¤ã®ã‚ã‚‹æŒ‡ã§å™¨ç”¨ã«æã‚’æ¸¡ã‚‹ã€‚",
        tags: ["ã¿ã©ã‚Š","æœ¨ç™»ã‚Š","å°å‹"],
        imageUrl: "images/tree-frog.png",
        size: "3ã€œ5cm",
        habitat: "æ£®æ—ãƒ»åº­æœ¨",
        createdAt: "2025-10-01"
      },
      {
        id: "2",
        name: "ãƒ¤ãƒãƒã‚³",
        category: "å“ºä¹³é¡",
        description: "å¤œè¡Œæ€§ã€‚é‹­ã„çˆªã¨è€³ã‚’æŒã¡ã€å°å‹•ç‰©ã‚’å·§ã¿ã«ç‹©ã‚‹ã€‚",
        tags: ["ã­ã“","å¤œè¡Œæ€§"],
        imageUrl: "images/wildcat.jpg",
        size: "50ã€œ60cm",
        habitat: "å±±åœ°ãƒ»æ£®æ—",
        createdAt: "2025-10-05"
      },
      {
        id: "3",
        name: "ã‚¯ãƒ­ãƒ„ã‚°ãƒŸ",
        category: "é³¥é¡",
        description: "æ¾„ã‚“ã ã•ãˆãšã‚Šã§çŸ¥ã‚‰ã‚Œã‚‹ãƒ„ã‚°ãƒŸã®ä»²é–“ã€‚æ˜¥ã«ç¾ã—ãé³´ãã€‚",
        tags: ["ã•ãˆãšã‚Š","æ¸¡ã‚Š"],
        imageUrl: "images/black-thrush.jpg",
        size: "20ã€œ24cm",
        habitat: "è½è‘‰åºƒè‘‰æ¨¹æ—",
        createdAt: "2025-09-20"
      },
      {
        id: "4",
        name: "ãƒ’ãƒ¡ãƒˆã‚«ã‚²",
        category: "ã¯ã¡ã‚…ã†é¡",
        description: "ç´°é•·ã„ä½“ã¨ç´ æ—©ã„å‹•ãã€‚æ—¥å…‰æµ´ãŒå¤§å¥½ãã€‚",
        tags: ["ã¨ã‹ã’","ç ‚åœ°"],
        imageUrl: "images/lizard.jpg",
        size: "10ã€œ14cm",
        habitat: "è‰åœ°ãƒ»ç ‚åœ°",
        createdAt: "2025-10-10"
      }
    ];

    // â€”â€”â€” ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã•ã‚Œã¦ã„ãŸã‚‰èª­ã¿è¾¼ã‚€ï¼ˆç·¨é›†ã‚’ä¿æŒï¼‰
    const saved = localStorage.getItem("mini-encyclopedia");
    if(saved){
      try{ const parsed = JSON.parse(saved); if(Array.isArray(parsed)) mergeUserEdits(parsed); }catch(e){}
    }
    function mergeUserEdits(arr){
      // id ãŒä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’ç½®ãæ›ãˆã€æœªçŸ¥ id ã¯è¿½åŠ 
      const map = new Map(data.map(x=>[x.id,x]));
      for(const x of arr){ map.set(x.id, {...map.get(x.id), ...x}); }
      entries = Array.from(map.values());
    }

    /** @type {Entry[]} */
    let entries = data.slice();

    // â€”â€”â€” UI è¦ç´ 
    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const category = document.getElementById('category');
    const sortSel = document.getElementById('sort');
    const countEl = document.getElementById('count');
    const modal = document.getElementById('modal');
    const mName = document.getElementById('mName');
    const mDesc = document.getElementById('mDesc');
    const mImg = document.getElementById('mImg');
    const mKv = document.getElementById('mKv');
    const mTags = document.getElementById('mTags');

    // â€”â€”â€” ã‚«ãƒ†ã‚´ãƒªåˆæœŸåŒ–
    function initCategories(){
      const set = new Set(entries.map(e=>e.category));
      const opts = ["", ...Array.from(set)];
      category.innerHTML = opts.map(v=>`<option value="${escapeHtml(v)}">${v||'ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª'}</option>`).join('');
    }

    // â€”â€”â€” ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    function render(){
      const kw = q.value.trim().toLowerCase();
      const cat = category.value;
      let list = entries.filter(e=>{
        const hitKw = !kw || [e.name, e.description, ...(e.tags||[])].join(' ').toLowerCase().includes(kw);
        const hitCat = !cat || e.category === cat;
        return hitKw && hitCat;
      });
      if(sortSel.value === 'name') list.sort((a,b)=>a.name.localeCompare(b.name,'ja'));
      else if(sortSel.value === 'new') list.sort((a,b)=> (b.createdAt||'').localeCompare(a.createdAt||''));

      countEl.textContent = `${list.length} ä»¶`;
      grid.innerHTML = list.map(entryToCard).join('');

      // ç”»åƒé…å»¶èª­ã¿è¾¼ã¿ & ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©
      grid.querySelectorAll('.card').forEach(card=>{
        card.addEventListener('click', ()=> openDetail(card.dataset.id));
        const img = card.querySelector('img[data-src]');
        if(img){ img.src = img.dataset.src; img.removeAttribute('data-src'); }
      });

      // ä¿å­˜
      localStorage.setItem('mini-encyclopedia', JSON.stringify(entries));
    }

    function entryToCard(e){
      const fallback = svgPlaceholder(e.name);
      const img = e.imageUrl ? `<img alt="${escapeHtml(e.name)}" data-src="${escapeAttr(e.imageUrl)}">` : fallback;
      const tags = (e.tags||[]).slice(0,3).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('');
      return `
        <article class="card" tabindex="0" role="button" aria-label="${escapeAttr(e.name)} ã®è©³ç´°ã‚’é–‹ã" data-id="${escapeAttr(e.id)}">
          <div class="thumb">${img}</div>
          <div class="body">
            <div class="name">${escapeHtml(e.name)}</div>
            <div class="meta">
              <span class="tag">${escapeHtml(e.category)}</span>
              ${tags}
            </div>
            <div class="desc">${escapeHtml(e.description)}</div>
          </div>
        </article>`;
    }

    function openDetail(id){
      const e = entries.find(x=>x.id===id);
      if(!e) return;
      mName.textContent = e.name;
      mDesc.textContent = e.description;
      mImg.src = e.imageUrl || dataUrlFromText(e.name);
      mImg.alt = e.name + ' ã®ç”»åƒ';
      mKv.innerHTML = '';
      const kvs = [
        ['ã‚«ãƒ†ã‚´ãƒª', e.category],
        ['ã‚µã‚¤ã‚º', e.size||'-'],
        ['ç”Ÿæ¯åŸŸ', e.habitat||'-'],
        ['ãƒ¡ãƒ¢', e.note||'-']
      ];
      for(const [k,v] of kvs){
        const div = document.createElement('div');
        div.innerHTML = `<span style="color:var(--muted)">${escapeHtml(k)}</span><span>${escapeHtml(v)}</span>`;
        mKv.appendChild(div);
      }
      mTags.innerHTML = (e.tags||[]).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('');
      modal.showModal();
    }

    document.getElementById('closeModal').addEventListener('click', ()=>modal.close());

    // â€”â€”â€” ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    function escapeHtml(s=''){return String(s).replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
    function escapeAttr(s=''){return String(s).replace(/"/g,'&quot;')}

    // åå‰ã‹ã‚‰ç°¡æ˜“SVGã‚µãƒ ãƒã‚¤ãƒ«ã‚’ç”Ÿæˆï¼ˆç”»åƒãŒãªã„ã¨ãç”¨ï¼‰
    function svgPlaceholder(text){
      const t = (text||'').slice(0,6);
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'>
        <defs>
          <linearGradient id='g' x1='0' x2='1'>
            <stop offset='0' stop-color='#1e293b'/>
            <stop offset='1' stop-color='#0b1222'/>
          </linearGradient>
        </defs>
        <rect width='800' height='500' fill='url(#g)'/>
        <text x='50%' y='52%' text-anchor='middle' font-size='64' fill='#94a3b8' font-family='system-ui, sans-serif'>${escapeHtml(t)}</text>
      </svg>`;
      return `<img alt='placeholder' data-src='data:image/svg+xml;utf8,${encodeURIComponent(svg)}'>`;
    }

    function dataUrlFromText(text){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'>
        <rect width='800' height='500' fill='#0b1222'/>
        <text x='50%' y='52%' text-anchor='middle' font-size='64' fill='#94a3b8' font-family='system-ui, sans-serif'>${escapeHtml(text)}</text>
      </svg>`;
      return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);
    }

    // â€”â€”â€” äº‹ä»¶: å…¥åŠ›ãƒ»é¸æŠãŒå¤‰ã‚ã£ãŸã‚‰å†æç”»
    q.addEventListener('input', render);
    category.addEventListener('change', render);
    sortSel.addEventListener('change', render);

    // â€”â€”â€” ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: ç¾åœ¨ã® entries ã‚’ JSON ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(entries, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'encyclopedia-data.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    // â€”â€”â€” ã‚µãƒ³ãƒ—ãƒ«1ä»¶è¿½åŠ 
    document.getElementById('addSample').addEventListener('click', ()=>{
      const id = String(Date.now());
      entries.unshift({
        id,
        name: `æ–°ã—ã„é …ç›® ${new Date().toLocaleDateString('ja-JP')}`,
        category: "æœªåˆ†é¡",
        description: "ã“ã“ã«èª¬æ˜ã‚’æ›¸ãã¾ã™ã€‚",
        tags: ["ã‚µãƒ³ãƒ—ãƒ«"],
        createdAt: new Date().toISOString().slice(0,10)
      });
      initCategories();
      render();
    });

    // åˆæœŸåŒ–
    initCategories();
    render();
  </script>
</body>
</html>

